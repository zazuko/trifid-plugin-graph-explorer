${set('moduleAbout','<a href="http://about.yasgui.org/" target="_blank">YASGUI</a>')}
<!DOCTYPE html>
<html>
<head>

${include('cwd:views/header.html')}

  <script type="text/javascript" src="dist/graph-explorer-full.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/react/16.14.0/umd/react.production.min.js"></script>
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/16.14.0/umd/react-dom.production.min.js"></script>

  <style type="text/css">
    html, body {
      height: 100%;
    }

    #container {
      height: calc(100% - 168px);
      overflow: hidden;
      margin: 0;
      padding: 0;
    }
  </style>

  <script type="text/javascript">
    //<![CDATA[
    window.onload = function () {
      const SparqlDialect = GraphExplorer.OWLStatsSettings;
      SparqlDialect.schemaLabelProperty = '${schemaLabelProperty}';

      function onWorkspaceMounted(workspace) {
        if (!workspace) {
          return;
        }

        const model = workspace.getModel();

        model.importLayout({
          dataProvider: new GraphExplorer.SparqlDataProvider({
            endpointUrl: '${endpointUrl}',
            acceptBlankNodes: ${acceptBlankNodes},
            imagePropertyUris: [
              'http://xmlns.com/foaf/0.1/img',
            ],
            queryMethod: GraphExplorer.SparqlQueryMethod.GET
          }, SparqlDialect),
        });

        /**
        * get the '?resources' search param and load those resources
        */
        const url = new URL(window.location.href);
        const resources = url.searchParams.get('resources');

        if (resources) {
          const elm = model.dataProvider.elementInfo({
            elementIds: resources.split(';'),
          });

          elm.then(function(arg) {
            const elmIds = [];
            resources.split(';').forEach(function(item) {
              const node = model.createElement(arg[item]);
              elmIds[item] = node.id;
              workspace.forceLayout();
            });
            return elmIds;
          }).then(function(elmIds) {
            /* now that we have the resources, add the links */
            const lnk = model.dataProvider.linksInfo({ elementIds: resources.split(';') })
            lnk.then(function(arg){
              arg.forEach(function(link) {
                const newLink = new GraphExplorer.Link({
                  typeId: link.linkTypeId,
                  sourceId: elmIds[link.sourceId],
                  targetId: elmIds[link.targetId],
                });
                model.addLink(newLink);
                workspace.forceLayout();
              });
            });
          });
        }
      }

      const props = {
        ref: onWorkspaceMounted,
        languages: JSON.parse('${languages}'),
        language: '${language}'
      };

      ReactDOM.render(
        React.createElement(GraphExplorer.Workspace, props),
        document.getElementById('container')
      );
    }
    //]]>
  </script>
</head>
<body>

${include('cwd:views/navigation.html')}

<div id="container"></div>

${include('cwd:views/footer.html')}

</div>

</body>
</html>
