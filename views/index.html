${set('moduleAbout','<a href="http://about.yasgui.org/" target="_blank">YASGUI</a>')}
<!DOCTYPE html>
<html>
<head>

${include('cwd:views/header.html')}

  <script type="text/javascript" src="dist/graph-explorer-full.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/react/16.14.0/umd/react.production.min.js"></script>
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/16.14.0/umd/react-dom.production.min.js"></script>

  <style type="text/css">
    html, body {
      height: 100%;
    }
    #container {
      height: calc(100% - 168px);
      overflow: hidden;
      margin: 0;
      padding: 0;
    }
  </style>

  <script type="text/javascript">
    //<![CDATA[
    window.onload = function () {
      let SparqlDialect = GraphExplorer.OWLStatsSettings
      /* this could be configurable */
      SparqlDialect.schemaLabelProperty = '${schemaLabelProperty}'

      function onWorkspaceMounted(workspace) {
        if (!workspace) { return; }
        workspace.getModel().importLayout({
          dataProvider: new GraphExplorer.SparqlDataProvider({
            endpointUrl: '${endpointUrl}',
            acceptBlankNodes: ${acceptBlankNodes},
            imagePropertyUris: [
              'http://xmlns.com/foaf/0.1/img',
            ],
            queryMethod: GraphExplorer.SparqlQueryMethod.GET
          }, SparqlDialect),
        });

        /**
        * get the '?resource' search param and load that resource.
        */
        let url = new URL(window.location.href);
        let resource = url.searchParams.get("resource");
        if (resource != null) {
          let elm = workspace.getModel().dataProvider.elementInfo({elementIds: [resource]});
            elm.then(function(arg) {
            workspace.getModel().createElement(arg[resource])
            workspace.forceLayout();
          });
        }
        let resources = url.searchParams.get("resources");
        if(resources != null)
        {
            let elm = model.dataProvider.elementInfo({elementIds: resources.split(';')});
            elm.then(function(arg){
                let elmIds = []
        				resources.split(';').forEach( function(item) {
               	  let node = model.createElement(arg[item])
                  elmIds[item] = node.id;
               	  workspace.forceLayout();
				        })
                return elmIds
            }).then(function(elmIds) {
                /* now that we have the resources, add the links */
                let lnk = model.dataProvider.linksInfo({elementIds: resources.split(';')})
                lnk.then(function(arg){
                    arg.forEach(function(link) {
                      let newLink = new GraphExplorer.Link({ typeId : link.linkTypeId,sourceId : elmIds[link.sourceId],targetId : elmIds[link.targetId]})
                      model.addLink(newLink)
                      workspace.forceLayout();
                    })
                })
            });
        }
      }
      const props = {
          ref: onWorkspaceMounted,
          /* this could be configurable */
          languages: [
            {code: 'de', label: 'German'},
            {code: 'fr', label: 'French'},
            {code: 'it', label: 'Italian'},
          ],
          language: 'de'
      };

      ReactDOM.render(
        React.createElement(GraphExplorer.Workspace, props),
        document.getElementById('container')
      );
    }
    //]]>
  </script>
</head>
<body>

${include('cwd:views/navigation.html')}

<div id="container"></div>

${include('cwd:views/footer.html')}

</div>

</body>
</html>
